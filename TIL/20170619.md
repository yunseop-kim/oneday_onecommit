# REST API
## Episode 1 - 광고판
### 리소스와 표현
- **리소스**: http://www.youtypeitwepostit.com/ 와 같은 URL이 붙은 것들의 기술적 용어
- **표현 (Representation)**
    - 브라우저 -> http 요청 -> 서버 -> 응답 -> 문서 (HTML, 바이너리 이미지 등)
    - 위 순서로 문서를 받아온다. 이 문서를 리소스의 '**표현**'이라 부름
    - 클라이언트가 URL에 HTTP 요청을 보내면, 하부 리소스의 표현을 받아오는 것.

### 주소 지정 가능성
- 1개 URL = 1개 리소스가 원칙.
- 안 좋은 예) 레스토랑 웹 사이트
    - 웹 사이트 전체가 플래시 인터페이스로 되어 있는 경우
    - 메뉴, 레스토랑 위치 지도 등을 가리키는 URL을 찾을 수 없는 경우
- 주소 지정 가능성의 원칙은 모든 리소스는 **자신의 고유한 URL**을 가져야 한다는 것

## Episode 2 - 홈페이지
### 요청
```
GET / HTTP/1.1
Host: http://www.youtypeitwepostit.com
```

### 응답
```
HTTP/1.1 200 OK
Content-Type: text/html

<!Doctype html>
...
```

- 200은 상태 코드 (응답 코드)
- 브라우저는 응답을 HTML 문서로 해독해 화면에 표시함

### 짧은 세션
- **무상태(stateless)**
    - 사용자가 웹 페이지에 도착했다고 해도, 서버 입장에서는 사용자가 어디에 있는지 전혀 신경쓰지 않는다.
    - HTTP 세션은 한개의 요청 동안 유지가 된다. 클라이언트의 요청에 서버는 응답한다.
    - 사용자가 폰을 꺼뒀다가 다음달 다시 켜서 내부 캐시로부터 페이지를 불러들여서 링크를 클릭해도 여전히 동작한다는 뜻.
    - 웹 서버는 사용자가 돌아오길 간절히 기다리지 않는다.

### **자기 서술형 메시지**
- 웹 사이트에 접속하면 홈페이지의 마크업은 링크를 포함한다. /about, /message 이다.
- HTML 문서는 요청한 정보만 주는 것이 아니라, 문서 다음에 무엇을 해야할지 알 수 있게 도와준다.

## 에피소드 3 - 링크
- 사용자가 '시작하기'를 링크를 클릭하면, 브라우저에게 HTTP 요청을 하라고 지시하는 것.
`<a href="/messages">Get Started</a>` 

- 요청
```
GET /messages HTTP/1.1
Host: www.youtypeitwepostit.com
```
    
- GET은 메서드. 리소스의 표현을 내게 줘 라는 뜻.

- 응답
```
HTTP/1.1 200 OK
Content-Type: text/html
...
<!DOCTYPE html>
...

```
- 마찬가지로 브라우저는 HTML을 화면에 뿌린다.

### 표준화된 메서드
- GET, POST, HEAD, PUT, DELETE 등

## 에피소드 4 - 폼과 리다이렉트
- 텍스트 상자에 'test' 입력 후 post 버튼을 누른다.

요청
```
POST /messages HTTP/1.1
Host: www.youtypeitwepostit.com
Content-Type: application/x-www-form-urlencoded

message=Test&submit=Post
```
응답
```
HTTP/1.1 303 See Other
Content-Type: text/html
Location: http://www.youtypeitwepostit.com/messages/231323243
```
- 303은 사용자의 브라우저가 Location의 헤더에 주어진 URL로 네 번째 HTTP 요청을 자동으로 보내게 함.

```
GET /messages/231323243 HTTP/1.1
```
- 200 응답 코드와 HTML 문서로 응답함.
```
HTTP/1.1 200 OK
Content-Type: text/html

<!DOCTYPE html>
...

```

### 애플리케이션 상태
- 브라우저의 입장에서 상태도
- null->Get /->홈페이지->Get /messages->메시지 목록->Post /messages->메시지 목록->Get /messages/2133249523432->개별 메시지
- REST에서는 '어떤 페이지에 와 있는가?'라는 이 정보를 <**애플리케이션 상태**> 라고 부른다. 현재 클라이언트가 있는 페이지를 말한다.

### 리소스 상태
- 홈페이지 / -> self
- 메시지 목록 (2메시지) /messages -> self
- 메시지 목록 (2메시지) /messages -> post -> 메시지 목록 (3메시지) /messages -> 새 상태
    - 위와 같이 서버에서 두개의 리소스를 관리한다.
    - /에서 제공하는 홈페이지, 그리고 /messages의 메시지 목록
### 연결
- 연결의 원칙
    - 웹의 망을 이루는 요소는 a 태그와 form 태그로 사용자가 사용할 수 있는 Get, Post 요청을 나타낸다.
    - 이 원칙 위에 동작한다. 이를 HATEOAS (애플리케이션 상태의 엔진으로서 하이퍼미디어) 라고 함. 필자는 '연결' 혹은 '하이퍼미디어 제약 조건' 이라 부를 예정.
    - 하이퍼미디어: HTML, 링크, 폼 등을 부르는 일반 용어. 서버가 다음에 뭘 할수 있는지 클라이언트에 설명하는 기법.
    - HATEOAS는 우리 모두가 웹을 폼 작성하고 링크를 따라가는 것으로 사용한다고 말하는 것과 같음.

### 웹은 뭔가 특별하다.
- 웹의 역사
    - Gopher 프로토콜, FTP, Archie, Veronica, Jughead, WAIS, Prospero... 등의 많은 프로토콜이 있었지만 이들은 사라지거나 웹 사이트로 대체되었음. HTTP GET으로..
    - P2P 프로토콜, SSH 등의 실시간 프로토콜을 제외하고는 HTTP면 충분함.
    - 마치 춘추전국시대가 종결된 느낌.
    - 2000년에 나온 로이 필딩의 박사학위 논문에서 아주 잘 설명하고 있음.

### 웹보다 더 뒤쳐지는 웹 API
- Web API 를 작성하며 겪었을법한 문제들
    - 웹 API는 각기 다른 리소스에 접근할 URL 구성 방법을 사람이 읽을 수 있는 문서로 설명함.
        - REST에서는 URL 구성법을 사람이 읽을 별도 문서로 작성하는 것은 연결의 원칙이나 자기 서술 메시지 원칙을 어기는 것.
    - 웹 사이트의 도움말 문서들. 누가 보냐. 중부난방으로 연결된 큰 메뉴를 제공하는 것. 이는 특정 리소스가 다른 리소스와 어떤 관련이 있는지 알기 어려움
    - 새 API를 추가하면 커스텀 SW나 누군가 작성한 일회성 라이브러리를 설치해야할 필요성. (우리나라 엑티브X 같은). 하나의 API 클라이언트가 전 세계의 모든 API를 이해하는 상황이 오지는 않을 것이다. 그러나 리팩터링 필요한 코드가 너무나 많음. 이는 API 가 자기 서술형 표현을 가질 때에만 가능함.
        - 솔직히 뭔 소린지 모르겠다.
        - 여기서 말하고 싶은 것은 '자기 서술형 표현' 인 것 같은데.
    - API가 변경되면 커스텀 API 클라이언트는 동작하지 않아 고쳐줘야 함. 웹 사이트가 새 디자인으로 변경되면 사이트 사용자가 디자인을 맘에 안들어해도 적응하면 그만임. 브라우저가 동작을 멈추지 않음.
        - REST에서의 웹 사이트 재디자인은 웹 사이트가 제공하는 자기 서술형 HTML 문서에 완전히 캡슐화 되어 있음. 클라이언트가 이전의 HTML 문서를 이해한다면 새 문서도 이해할 수 있음.

### 의미 체계의 문제
- 사용자의 브라우저가 페이지를 렌더링 할 때마다 앨리스가 페이지를 보고 그 다음에 무엇을 할지 결정한다. 웹은 어떤 링크를 클릭할지, 어떤 폼을 입력할지 사람이 결정을 내리기 떄문에 동작한다.
- 웹 API의 요점은 사람이 브라우저 앞에서 앉아 모든 결정을 내리지 않아도 된다는 것.
- 컴퓨터가 HTML 마크업 `<a href="/messages">Get Started</a>`를 파싱할 수는 있지만 'Get Started'를 이해하지는 못함.
- 소프트웨어 소비자들이 이 메시지를 이해할 수 없다면 왜 API에 자기 서술형 메시지를 넣어야 하는가? 이것이 가장 큰 도전이다.
- 의미 체계의 문제
    - 문서의 구조를 이해하는 것과 문서의 의미를 이해하는 것 사이의 의미적 차이.
    - 앞으로 깊이 다룰 예정.
    - 근데 내가 이해가 안되네.